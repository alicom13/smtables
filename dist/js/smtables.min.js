/*!
 * SMTables v1.0.0 - Simple Magic Tables
 * Single file, zero-dependency table library
 * Export: CSV (with escaping) | Copy: TSV (Excel-ready)
 * @copyright 2025 Ali Musthofa
 * @license MIT
 * @link https://github.com/alicom13/smtables
 */
!function(){"use strict";class t{constructor(t,e=10){if(!t)throw new Error("Table element is required");if(!document.querySelector("#smt-styles")){const t=document.createElement("style");t.id="smt-styles",t.textContent='.smt-container{margin-bottom:1rem}.smt-controls{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:.75rem;margin-bottom:1rem}.smt-search{flex:1;min-width:200px}.smt-search input{width:100%;padding:.375rem .75rem;border:1px solid #ccc;border-radius:4px;font-family:inherit}.smt-controls-right{display:flex;align-items:center;gap:.75rem}.smt-btn-group{display:flex;align-items:center;gap:0;border:1px solid #ccc;border-radius:4px;overflow:hidden;background:#fff}.smt-btn{background:#fff;border:none;padding:0;cursor:pointer;font-size:1rem;display:flex;align-items:center;justify-content:center;height:2rem;width:2rem;transition:background-color .2s;border-right:1px solid #eee;position:relative}.smt-btn:last-child{border-right:none}.smt-btn:hover{background:#f0f0f0}.smt-btn.selected::before{content:"\\2713"}.smt-btn.csv::before{content:"\\1F4CE"}.smt-btn.copy::before{content:"\\1F4C4"}.smt-pagination-controls{display:flex;align-items:center;gap:.75rem}.smt-selection{white-space:nowrap}.smt-perpage select{padding:.25rem .5rem;border:1px solid #ccc;border-radius:4px;background:#fff;cursor:pointer;font-family:inherit}.smt-pagination{display:flex;justify-content:center;align-items:center;gap:.5rem;margin-top:1rem;flex-wrap:wrap}.smt-pagination button{padding:.375rem .75rem;border:1px solid #ccc;background:#fff;border-radius:4px;cursor:pointer;font-family:inherit}.smt-pagination button.active{background:#007bff;color:#fff;border-color:#007bff}.smt-pagination button:disabled{opacity:.5;cursor:not-allowed}.smtables th{cursor:pointer;user-select:none;position:relative}.smtables th.smt-sort-asc::after{content:" \\2191";font-weight:700;margin-left:.25rem}.smtables th.smt-sort-desc::after{content:" \\2193";font-weight:700;margin-left:.25rem}.smt-loading,.smt-empty{text-align:center;padding:2rem}.smt-info{margin-top:.5rem;text-align:center}@media (max-width:768px){.smt-controls{flex-direction:column;align-items:stretch}.smt-search{min-width:100%}.smt-controls-right{width:100%;justify-content:space-between}.smt-pagination-controls{order:-1;width:100%;justify-content:space-between;margin-bottom:.5rem}}@media (max-width:480px){.smt-controls-right{flex-direction:column;gap:.5rem}.smt-pagination-controls{flex-direction:row;justify-content:space-between}.smt-btn-group{width:100%;justify-content:center}}',document.head.appendChild(t)}t.classList.add("smtables"),this.table=t,this.tbody=t.querySelector("tbody"),this.rows=Array.from(this.tbody.querySelectorAll("tr")),this.filteredRows=[...this.rows],this.page=1,this.perPage=e,this.sortColumn=null,this.sortDirection="asc",this.searchTerm="",this.checkboxState=new WeakMap,this.searchHandler=this.debounce(this.setSearch.bind(this),300),this.createControls(),this.enableSorting(),this.initCheckboxes(),this.render()}createControls(){const t=document.createElement("div");t.className="smt-container";const e=document.createElement("div");e.className="smt-controls";const o=document.createElement("div");o.className="smt-search",this.searchBox=document.createElement("input"),this.searchBox.type="search",this.searchBox.placeholder="Search...",this.searchBox.addEventListener("input",t=>this.searchHandler(t.target.value));const s=document.createElement("div");s.className="smt-controls-right";const i=document.createElement("div");i.className="smt-btn-group";const n=document.createElement("button");n.className="smt-btn selected",n.title="Export Selected Rows (CSV)",n.setAttribute("aria-label","Export selected rows"),n.onclick=()=>this.exportSelected(),this.csvBtn=document.createElement("button"),this.csvBtn.className="smt-btn csv",this.csvBtn.title="Export to CSV (comma separated)",this.csvBtn.setAttribute("aria-label","Export to CSV"),this.csvBtn.onclick=()=>this.exportToCSV(),this.copyBtn=document.createElement("button"),this.copyBtn.className="smt-btn copy",this.copyBtn.title="Copy to Clipboard (Excel-ready)",this.copyBtn.setAttribute("aria-label","Copy to clipboard"),this.copyBtn.onclick=()=>this.copyToClipboard(),i.appendChild(n),i.appendChild(this.csvBtn),i.appendChild(this.copyBtn);const r=document.createElement("div");r.className="smt-pagination-controls",this.selectionCounter=document.createElement("span"),this.selectionCounter.className="smt-selection",this.updateSelectionCounter(),this.perPageSelect=document.createElement("select"),this.perPageSelect.className="smt-perpage",this.perPageSelect.setAttribute("aria-label","Rows per page"),this.perPageSelect.innerHTML='<option value="5">5</option><option value="10" selected>10</option><option value="20">20</option><option value="50">50</option><option value="100">100</option>',this.perPageSelect.value=this.perPage,this.perPageSelect.addEventListener("change",()=>{this.perPage=parseInt(this.perPageSelect.value),this.page=1,this.render()}),r.appendChild(this.selectionCounter),r.appendChild(this.perPageSelect),o.appendChild(this.searchBox),s.appendChild(i),s.appendChild(r),e.appendChild(o),e.appendChild(s),t.appendChild(e),this.table.parentNode.insertBefore(t,this.table),t.appendChild(this.table),this.paginationContainer=document.createElement("div"),this.paginationContainer.className="smt-pagination",t.appendChild(this.paginationContainer),this.infoContainer=document.createElement("div"),this.infoContainer.className="smt-info",t.appendChild(this.infoContainer),this.updateInfo()}enableSorting(){this.table.querySelectorAll("thead th").forEach((t,e)=>{t.querySelector("input, select, button")||(t.style.cursor="pointer",t.setAttribute("role","button"),t.setAttribute("aria-label",`Sort by ${t.textContent.trim()}`),t.addEventListener("click",()=>this.handleSort(e)))})}handleSort(t){const e=this.table.querySelectorAll("thead th");e.forEach(t=>{t.classList.remove("smt-sort-asc","smt-sort-desc"),t.removeAttribute("aria-sort")}),this.sortColumn===t?this.sortDirection="asc"===this.sortDirection?"desc":"asc":(this.sortColumn=t,this.sortDirection="asc"),e[t].classList.add("smt-sort-"+this.sortDirection),e[t].setAttribute("aria-sort","asc"===this.sortDirection?"ascending":"descending"),this.sortRows(),this.render()}sortRows(){null!==this.sortColumn&&this.filteredRows.sort((t,e)=>{const o=t.children[this.sortColumn],s=e.children[this.sortColumn];if(!o||!s)return 0;const i=o.textContent.trim().toLowerCase(),n=s.textContent.trim().toLowerCase(),r=parseFloat(i),a=parseFloat(n);return isNaN(r)||isNaN(a)?"asc"===this.sortDirection?i.localeCompare(n):n.localeCompare(i):"asc"===this.sortDirection?r-a:a-r})}debounce(t,e){let o;return function(...s){clearTimeout(o),o=setTimeout(()=>{clearTimeout(o),t(...s)},e)}}setSearch(t){this.searchTerm=t.toLowerCase().trim(),this.filteredRows=this.rows.filter(t=>t.textContent.toLowerCase().includes(this.searchTerm)),null!==this.sortColumn&&this.sortRows(),this.page=1,this.render()}paginateRows(){const t=(this.page-1)*this.perPage;return this.filteredRows.slice(t,t+this.perPage)}renderTable(){const t=this.tbody.querySelector(".smt-empty");if(t&&t.remove(),this.rows.forEach(t=>t.style.display="none"),0===this.filteredRows.length)return void this.showEmptyState();const e=this.paginateRows();e.forEach(t=>t.style.display=""),this.restoreCheckboxes(),this.updateRowNumbers(e),this.updateSelectionCounter(),this.updateInfo()}showEmptyState(){const t=document.createElement("tr");t.className="smt-empty",t.setAttribute("aria-live","polite");const e=this.table.querySelectorAll("thead th").length;t.innerHTML='<td colspan="'+e+'">No data found</td>',this.tbody.appendChild(t)}updateRowNumbers(t){const e=(this.page-1)*this.perPage+1;t.forEach((t,o)=>{const s=t.querySelector(".row-number");s&&(s.textContent=e+o)})}updateInfo(){const t=this.filteredRows.length,e=0===t?0:(this.page-1)*this.perPage+1,o=Math.min(this.page*this.perPage,t);this.infoContainer.textContent=`Showing ${e} to ${o} of ${t} entries`,this.infoContainer.setAttribute("aria-live","polite")}renderPagination(){const t=this.paginationContainer,e=Math.ceil(this.filteredRows.length/this.perPage);if(e<=1)return void(t.innerHTML="");const o=1===this.page,s=this.page>=e;let i=`<button class="pagination-prev" ${o?"disabled":""} aria-label="Previous page">‹</button>`;this.getVisiblePages(e).forEach(t=>{if("..."===t)i+='<button class="pagination-ellipsis" disabled aria-hidden="true">...</button>';else{const e=t===this.page?"active":"",o=t===this.page?'aria-current="page"':"";i+=`<button class="pagination-number ${e}" ${o} aria-label="Page ${t}">${t}</button>`}}),i+=`<button class="pagination-next" ${s?"disabled":""} aria-label="Next page">›</button>`,t.innerHTML=i,t.querySelector("button:first-child").addEventListener("click",()=>{o||(this.page--,this.render())}),t.querySelector("button:last-child").addEventListener("click",()=>{s||(this.page++,this.render())}),t.querySelectorAll("button:not(:first-child):not(:last-child)").forEach(t=>{t.disabled||"..."===t.textContent||t.addEventListener("click",()=>{this.page=parseInt(t.textContent),this.render()})})}getVisiblePages(t){return t<=7?Array.from({length:t},(t,e)=>e+1):this.page<=4?[1,2,3,4,5,"...",t]:this.page>=t-3?[1,"...",t-4,t-3,t-2,t-1,t]:[1,"...",this.page-1,this.page,this.page+1,"...",t]}initCheckboxes(){this.tbody.addEventListener("change",t=>{const e=t.target;"checkbox"===e.type&&(this.checkboxState.set(e,e.checked),this.updateSelectionCounter())});const t=this.table.querySelector("thead input[type=checkbox]");t&&t.addEventListener("change",t=>{const e=t.target.checked;this.paginateRows().forEach(t=>{const o=t.querySelector("input[type=checkbox]");o&&(o.checked=e,this.checkboxState.set(o,e))}),this.updateSelectionCounter()})}restoreCheckboxes(){this.paginateRows().forEach(t=>{const e=t.querySelector("input[type=checkbox]");e&&this.checkboxState.has(e)&&(e.checked=this.checkboxState.get(e))}),this.updateSelectAllCheckbox()}updateSelectAllCheckbox(){const t=this.table.querySelector("thead input[type=checkbox]");if(t){const e=this.paginateRows().map(t=>t.querySelector("input[type=checkbox]")).filter(t=>t);if(0===e.length)t.checked=!1,t.disabled=!0;else{t.disabled=!1;const o=e.every(t=>t.checked);t.checked=o}}}updateSelectionCounter(){const t=this.getSelectedCount(),e=this.filteredRows.length;this.selectionCounter.textContent=`${t} of ${e} selected`,this.selectionCounter.setAttribute("aria-live","polite")}getSelectedCount(){let t=0;return this.filteredRows.forEach(e=>{const o=e.querySelector('input[type="checkbox"]');o&&o.checked&&t++}),t}exportSelected(){const t=this.getSelectedRows();if(0===t.length)return void alert("No data selected! Check the rows you want to export.");const e=this.getExportData(t),o=this.convertToCSV(e);this.downloadFile(o,"selected-data-"+this.getTimestamp()+".csv","text/csv"),alert(`Successfully exported ${t.length} selected rows as CSV!`)}getSelectedRows(){const t=[];return this.filteredRows.forEach(e=>{const o=e.querySelector('input[type="checkbox"]');o&&o.checked&&t.push(e)}),t}getSelectedIds(){return this.getSelectedRows().map(t=>{const e=t.querySelector('input[type="checkbox"]');return e?e.value:null}).filter(t=>null!==t)}copyToClipboard(){const t=this.getExportData(),e=this.convertToTSV(t);navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(e).then(()=>alert("Data copied to clipboard (Excel-ready)! Paste directly into Excel.")).catch(()=>this.fallbackCopy(e)):this.fallbackCopy(e)}fallbackCopy(t){const e=document.createElement("textarea");e.value=t,e.style.position="fixed",e.style.opacity="0",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),alert("Data copied to clipboard (Excel-ready)! Paste directly into Excel.")}getTableHeaders(){const t=[];return this.table.querySelectorAll("thead th").forEach(e=>{e.querySelector('input[type="checkbox"]')||"no"===e.textContent.trim().toLowerCase()||e.classList.contains("no-export")||t.push(e.textContent.trim())}),t}getExportData(t=null){const e=t||this.filteredRows,o=this.getTableHeaders();return e.map(t=>{const e={},s=t.querySelectorAll("td");let i=0;return this.table.querySelectorAll("thead th").forEach((t,n)=>{if(!t.querySelector('input[type="checkbox"]')&&"no"!==t.textContent.trim().toLowerCase()&&!t.classList.contains("no-export")&&s[n]&&o[i]){const t=s[n].cloneNode(!0);t.querySelector("button")?.remove(),e[o[i]]=t.textContent.trim(),i++}}),e})}exportToCSV(){const t=this.getExportData(),e=this.convertToCSV(t);this.downloadFile(e,"table-export-"+this.getTimestamp()+".csv","text/csv")}convertToCSV(t){if(0===t.length)return"";const e=Object.keys(t[0]);return[e.join(","),...t.map(t=>e.map(e=>{const o=(t[e]||"").toString().replace(/"/g,'""');return o.includes(",")||o.includes("\n")||o.includes('"')?'"'+o+'"':o}).join(","))].join("\n")}convertToTSV(t){if(0===t.length)return"";const e=Object.keys(t[0]);return[e.join("\t"),...t.map(t=>e.map(e=>(t[e]||"").toString().replace(/\t/g," ")).join("\t"))].join("\n")}downloadFile(t,e,o){const s=new Blob([t],{type:o}),i=URL.createObjectURL(s),n=document.createElement("a");n.href=i,n.download=e,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(i)}getTimestamp(){return(new Date).toISOString().slice(0,19).replace(/[:.]/g,"-")}render(){this.renderTable(),this.renderPagination()}updateData(t){if(Array.isArray(t))this.rows=t;else if("string"==typeof t)this.tbody.innerHTML=t,this.rows=Array.from(this.tbody.querySelectorAll("tr"));else{if(!(t instanceof NodeList))return;this.rows=Array.from(t)}this.filteredRows=[...this.rows],this.page=1,this.render()}destroy(){const t=this.table.parentNode;if(t.classList.contains("smt-container")){t.parentNode.insertBefore(this.table,t),t.remove()}this.table.classList.remove("smtables")}}document.addEventListener("DOMContentLoaded",()=>{window.smtables=[],document.querySelectorAll(".smtables").forEach(e=>{try{const o=new t(e,10);window.smtables.push(o)}catch{}})}),"undefined"!=typeof window&&(window.SMTables=t),"undefined"!=typeof module&&module.exports&&(module.exports=t)}();